---
title: ""
subtitle: ""
author: 
  - Andy Jiang
thanks: "Code and data are available at: [https://github.com/AndyYanxunJiang/grocery-price-analysis.git)."
date: today
date-format: long
abstract: ""
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(DBI)
library(RSQLite)
library(ggplot2)

# Connect to the SQLite database
con <- dbConnect(RSQLite::SQLite(), "/Users/y4nxunj/Downloads/hammer-2-processed.sqlite")  # Update path

# Run the join query from '01_join_raw_and_product.sql' to get combined data
query <- "
  SELECT 
      r.nowtime, 
      p.vendor, 
      r.product_id, 
      p.product_name, 
      p.brand, 
      r.current_price, 
      r.old_price, 
      p.units, 
      r.price_per_unit, 
      r.other 
  FROM 
      raw AS r
  INNER JOIN 
      product AS p ON r.product_id = p.id
  ORDER BY 
      r.nowtime;
"
data <- dbGetQuery(con, query)

# Disconnect from the database
dbDisconnect(con)

# Now you have 'data' in R and can use it for visualizations, e.g., average price by vendor
avg_price_by_vendor <- aggregate(current_price ~ vendor, data, mean)

ggplot(avg_price_by_vendor, aes(x = vendor, y = current_price, fill = vendor)) +
  geom_bar(stat = "identity") +
  labs(title = "Average Price by Vendor",
       x = "Vendor", y = "Average Price") +
  theme_minimal() +
  theme(legend.position = "none")

```


# Introduction

In recent years, music streaming platforms have provided vast amounts of data that enable a deeper analysis of the characteristics of different artists’ music. By utilizing Spotify’s audio feature data, we can examine several aspects of a song such as duration, tempo, energy, and valence (a measure of musical positivity or happiness). In this analysis, we focus on two globally renowned artists, Beyoncé and Coldplay, to compare key audio features of their music over time.

This study examines the duration and valence of songs released by Beyoncé and Coldplay, offering insights into how these attributes vary between the two artists. The analysis is visualized through boxplots and scatter plots, helping to reveal trends in their musical style and production across different time periods. The results suggest that while Beyoncé’s music varies more in duration and has a higher valence (indicating happier music), Coldplay’s songs are generally more consistent in length, with less valence or happiness expressed in their tracks.



# Data {#sec-data}
We use the statistical programming language R [@citeR], and library tidyverse [@tidyverse], spotifyr [@citeSpotifyr], lubridate [@lubridate], ggplot2 [@citeGG]. The data is from Spotify [@spotify].

## Overview
The key attributes of the data include:

Duration: Measured in milliseconds, this represents the length of each track.
Valence: A measure from 0 to 1 indicating how happy or sad a track sounds. Higher values correspond to happier, more cheerful music, while lower values indicate sadness or melancholy.
Album release date: The date when each album was released, which helps in analyzing trends over time.
Using this dataset, we compared the two artists on two main dimensions: song duration and valence.

@sec-results discusses our findings on the song duration and valence between the two artists.


# Results {#sec-results}
Our results on song duration are summarized in @fig-duration-beyonce and @fig-duration-coldplay. And our results on valence are summerized in @fig-valence.


```{r}
#| label: fig-duration-coldplay
#| fig-cap: Duration of Songs of Coldplay
#| echo: false
#| warning: false
#| message: false
# Filter for rows where products were on sale
sales_data <- subset(data, !is.na(old_price))

# Count sales occurrences by vendor
sales_count <- as.data.frame(table(sales_data$vendor))
colnames(sales_count) <- c("vendor", "sale_count")

# Plot frequency of sales by vendor
ggplot(sales_count, aes(x = vendor, y = sale_count, fill = vendor)) +
  geom_bar(stat = "identity") +
  labs(title = "Frequency of Sales by Vendor",
       x = "Vendor", y = "Sale Count") +
  theme_minimal() +
  theme(legend.position = "none")

```

```{r}
#| label: fig-valence
#| fig-cap: Valence of the Two Artists' Songs
#| echo: false
#| warning: false
#| message: false

# Improved box plot with fewer jitter points and adjusted transparency and size
set.seed(42)  # For reproducible sampling
sampled_data <- data[sample(nrow(data), size = min(5000, nrow(data))), ]  # Sample 5000 points or fewer

ggplot(data, aes(x = vendor, y = current_price, fill = vendor)) +
  geom_boxplot(outlier.shape = NA, alpha = 0.6) +  # Hide outliers in box plot
  geom_jitter(data = sampled_data, width = 0.2, alpha = 0.1, size = 0.5, color = "black") +  # Sampled points with low transparency
  scale_y_continuous(trans = 'log10', limits = c(1, 100)) +  # Log scale and limit y-axis
  labs(title = "Price Distribution Across Vendors",
       x = "Vendor", y = "Current Price (Log Scale)") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.title = element_text(size = 16, face = "bold"),
        axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate x-axis labels for readability
  scale_fill_brewer(palette = "Set3")  # Use a color palette for better presentation


```


```{r}
# Plot distribution of prices by vendor
# Calculate average price per vendor
avg_price_by_vendor <- aggregate(current_price ~ vendor, data, mean, na.rm = TRUE)

# Plot average price by vendor
ggplot(avg_price_by_vendor, aes(x = vendor, y = current_price, fill = vendor)) +
  geom_bar(stat = "identity") +
  labs(title = "Average Price by Vendor",
       x = "Vendor", y = "Average Price") +
  theme_minimal() +
  theme(legend.position = "none")


```

## Song Duration
	
@fig-duration-beyonce and @fig-duration-coldplay illustrate song duration for Beyoncé and Coldplay over time. Several interesting observations can be made from these visualizations:

Beyoncé: The song duration for Beyoncé shows a wider range across the years, indicating a greater variability in how long her songs tend to be. Some of her albums contain shorter tracks, while others include significantly longer ones. This suggests that Beyoncé experiments more with song length, perhaps catering to different album concepts or genres.

Coldplay: On the other hand, Coldplay’s songs tend to be more consistent in duration, with less variation in length. While there are a few outliers with exceptionally long or short tracks, most of Coldplay’s songs stay within a narrower duration range. This may reflect Coldplay’s commitment to a particular style or format for their music.

## Valence

@fig-valence shows the valence, or happiness, of songs by Beyoncé and Coldplay over time. This is where the two artists differ most notably:

Beyoncé: Her songs have generally higher valence scores, meaning that her music tends to sound more upbeat, positive, and emotionally vibrant. This aligns with the perception of Beyoncé’s music, which often conveys themes of empowerment, celebration, and joy.

Coldplay: Coldplay’s music, in contrast, exhibits lower valence scores, suggesting a more melancholic or introspective tone. Coldplay is known for producing emotionally resonant tracks, often focusing on themes of love, loss, and reflection, which could explain the lower valence values.







\newpage


# References


